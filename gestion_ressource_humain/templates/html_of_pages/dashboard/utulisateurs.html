<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Tableau de bord - Gestion des utilisateurs</title>
    {% load static %}

    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD"
      crossorigin="anonymous"
    />

    <!-- Bootstrap Icons -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css"
    />

    <!-- CSS personnalisé -->
    <link rel="stylesheet" href="{% static 'css/dashboard/dashboard.css' %}" />
    <link rel="stylesheet" href="{% static 'css/dashboard/utulisateurs.css' %}" />
    <!-- Inline CSS pour styles spécifiques -->
    
  </head>
  <body>
    <!-- Conteneur principal -->
    <div class="container-fluid">
      <!-- Barre latérale -->
      {% include 'html_of_pages/dashboard/sidebar.html' %}

      <!-- Contenu principal -->
      <div class="content departments-content">
        <div class="container">
          <!-- En-tête -->
          <div class="d-flex justify-content-between align-items-center mb-4 mt-3">
            <div>
              <h1 class="h2">
                <i class="bi bi-people me-2"></i>Gestion des utilisateurs
              </h1>
              <p class="text-muted">
                Consultez, ajoutez, modifiez ou supprimez les utilisateurs de TeamCore.
              </p>
            </div>
          </div>

          <!-- Statistiques rapides -->
          <div class="row g-4 mb-4">
            <div class="col-md-6">
              <div class="card card-100 shadow-sm">
                <div class="card-body text-center">
                  <h5 class="card-title text-muted">
                    <i class="bi bi-person-fill me-2 text-primary"></i>
                    Nombre total d'utilisateurs
                  </h5>
                  <h2 class="card-text">150</h2>
                </div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="card card-100 shadow-sm">
                <div class="card-body">
                  <h5 class="card-title text-muted">
                    <i class="bi bi-person-gear me-2 text-success"></i>
                    Rôles les plus courants
                  </h5>
                  <ul class="list-unstyled mt-3">
                    <li>Employé : 80</li>
                    <li>RH : 30</li>
                    <li>Manager : 20</li>
                    <li>Administrateur : 20</li>
                  </ul>
                </div>
              </div>
            </div>
          </div>

          <!-- Bouton Ajouter -->
          <div class="mb-3">
            <button
              class="btn primary-button"
              data-bs-toggle="modal"
              data-bs-target="#addUserModal"
            >
              <i class="bi bi-plus-circle me-2"></i> Ajouter un utilisateur
            </button>
          </div>

          <!-- Tableau des utilisateurs -->
          <div class="card shadow-sm">
            <div class="card-body">
              <div class="d-flex justify-content-between align-items-center mb-3">
                <h5 class="card-title">
                  <i class="bi bi-table me-2"></i>Liste des utilisateurs
                </h5>
                <div class="search-table">
                  <input
                    type="text"
                    placeholder="Rechercher..."
                    class="border-0"
                    id="searchInput"
                  />
                </div>
              </div>
              <div class="table-responsive">
                <table class="table table-hover">
                  <thead>
                    <tr>
                      <th>Photo</th>
                      <th>Nom</th>
                      <th>Rôle</th>
                      <th>Statut</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody>
                    <!-- Exemples statiques -->
                    <tr>
                      <td>
                        <img
                          src="https://via.placeholder.com/40"
                          alt="Photo de Jean Dupont"
                          class="user-photo"
                        />
                      </td>
                      <td>Jean Dupont</td>
                      <td>RH</td>
                      <td>
                        <span class="status-badge status-connected">Connecté</span>
                      </td>
                      <td>
                        <a href="#" class="btn btnInfo btn-sm me-1">
                          <i class="bi bi-eye"></i>
                        </a>
                        <button
                          class="btn btnInfo btn-sm me-1"
                          data-bs-toggle="modal"
                          data-bs-target="#editUserModal"
                          onclick="fillEditModal(1, 'Jean Dupont', 'https://via.placeholder.com/40', '1')"
                        >
                          <i class="bi bi-pencil"></i>
                        </button>
                        <button
                          class="btn btnDanger btn-sm me-1"
                          data-bs-toggle="modal"
                          data-bs-target="#deleteUserModal"
                          onclick="setDeleteUserId(1)"
                        >
                          <i class="bi bi-archive-fill"></i>
                        </button>
                      </td>
                    </tr>
                    <tr>
                      <td>
                        <i class="bi bi-person-circle text-muted" style="font-size: 40px;"></i>
                      </td>
                      <td>Marie Curie</td>
                      <td>Employé</td>
                      <td>
                        <span class="status-badge status-disconnected">Déconnecté</span>
                      </td>
                      <td>
                        <a href="#" class="btn btnInfo btn-sm me-1">
                          <i class="bi bi-eye"></i>
                        </a>
                        <button
                          class="btn btnInfo btn-sm me-1"
                          data-bs-toggle="modal"
                          data-bs-target="#editUserModal"
                          onclick="fillEditModal(2, 'Marie Curie', '', '2')"
                        >
                          <i class="bi bi-pencil"></i>
                        </button>
                        <button
                          class="btn btnDanger btn-sm me-1"
                          data-bs-toggle="modal"
                          data-bs-target="#deleteUserModal"
                          onclick="setDeleteUserId(2)"
                        >
                          <i class="bi bi-archive-fill"></i>
                        </button>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          <!-- Modal pour ajouter un utilisateur -->
          <div
            class="modal fade"
            id="addUserModal"
            tabindex="-1"
            aria-labelledby="addUserModalLabel"
            aria-hidden="true"
          >
            <div class="modal-dialog modal-dialog-centered">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title" id="addUserModalLabel">Ajouter un utilisateur</h5>
                  <button
                    type="button"
                    class="btn-close"
                    data-bs-dismiss="modal"
                    aria-label="Fermer"
                  ></button>
                </div>
                <div class="modal-body">
                  <div class="mb-3">
                    <label for="addUsername" class="form-label">Nom d'utilisateur</label>
                    <input
                      type="text"
                      class="form-control"
                      id="addUsername"
                      placeholder="Nom d'utilisateur"
                      required
                    />
                  </div>
                  <div class="mb-3">
                    <label for="addPhotoUrl" class="form-label">URL de la photo</label>
                    <input
                      type="url"
                      class="form-control"
                      id="addPhotoUrl"
                      placeholder="https://example.com/photo.jpg"
                    />
                  </div>
                  <div class="mb-3">
                    <label for="addRole" class="form-label">Rôle</label>
                    <select class="form-select" id="addRole" required>
                      <option value="">Sélectionner un rôle</option>
                      <option value="1">RH</option>
                      <option value="2">Employé</option>
                      <option value="3">Manager</option>
                      <option value="4">Administrateur</option>
                    </select>
                  </div>
                </div>
                <div class="modal-footer">
                  <button
                    type="button"
                    class="btn btn-secondary"
                    data-bs-dismiss="modal"
                  >
                    Annuler
                  </button>
                  <button type="button" class="btn btn-primary">Ajouter</button>
                </div>
              </div>
            </div>
          </div>

          <!-- Modal pour modifier un utilisateur -->
          <div
            class="modal fade"
            id="editUserModal"
            tabindex="-1"
            aria-labelledby="editUserModalLabel"
            aria-hidden="true"
          >
            <div class="modal-dialog modal-dialog-centered">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title" id="editUserModalLabel">Modifier un utilisateur</h5>
                  <button
                    type="button"
                    class="btn-close"
                    data-bs-dismiss="modal"
                    aria-label="Fermer"
                  ></button>
                </div>
                <div class="modal-body">
                  <div class="mb-3">
                    <label for="editUsername" class="form-label">Nom d'utilisateur</label>
                    <input
                      type="text"
                      class="form-control"
                      id="editUsername"
                      placeholder="Nom d'utilisateur"
                      required
                    />
                  </div>
                  <div class="mb-3">
                    <label for="editPhotoUrl" class="form-label">URL de la photo</label>
                    <input
                      type="url"
                      class="form-control"
                      id="editPhotoUrl"
                      placeholder="https://example.com/photo.jpg"
                    />
                  </div>
                  <div class="mb-3">
                    <label for="editRole" class="form-label">Rôle</label>
                    <select class="form-select" id="editRole" required>
                      <option value="">Sélectionner un rôle</option>
                      <option value="1">RH</option>
                      <option value="2">Employé</option>
                      <option value="3">Manager</option>
                      <option value="4">Administrateur</option>
                    </select>
                  </div>
                </div>
                <div class="modal-footer">
                  <button
                    type="button"
                    class="btn btn-secondary"
                    data-bs-dismiss="modal"
                  >
                    Annuler
                  </button>
                  <button type="button" class="btn btn-primary">Enregistrer</button>
                </div>
              </div>
            </div>
          </div>

          <!-- Modal pour confirmer la suppression -->
          <div
            class="modal fade"
            id="deleteUserModal"
            tabindex="-1"
            aria-labelledby="deleteUserModalLabel"
            aria-hidden="true"
          >
            <div class="modal-dialog modal-dialog-centered">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title" id="deleteUserModalLabel">
                    Confirmer la suppression
                  </h5>
                  <button
                    type="button"
                    class="btn-close"
                    data-bs-dismiss="modal"
                    aria-label="Fermer"
                  ></button>
                </div>
                <div class="modal-body">
                  Êtes-vous sûr de vouloir supprimer cet utilisateur ? Cette action est irréversible.
                </div>
                <div class="modal-footer">
                  <button
                    type="button"
                    class="btn btn-secondary"
                    data-bs-dismiss="modal"
                  >
                    Annuler
                  </button>
                  <button type="button" class="btn btn-danger">Supprimer</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>

    <!-- JavaScript pour la recherche et les modals -->
    <script>
      // Recherche dans le tableau
      document.getElementById('searchInput').addEventListener('input', function () {
        const searchValue = this.value.toLowerCase();
        const rows = document.querySelectorAll('tbody tr');
        rows.forEach(row => {
          const username = row.cells[1].textContent.toLowerCase();
          const role = row.cells[2].textContent.toLowerCase();
          if (username.includes(searchValue) || role.includes(searchValue)) {
            row.style.display = '';
          } else {
            row.style.display = 'none';
          }
        });
      });

      // Remplir le modal de modification
      function fillEditModal(id, username, photoUrl, roleId) {
        document.getElementById('editUsername').value = username;
        document.getElementById('editPhotoUrl').value = photoUrl;
        document.getElementById('editRole').value = roleId;
      }

      // Placeholder pour la suppression
      function setDeleteUserId(id) {
        // Logique à implémenter dans le backend
        console.log('Supprimer utilisateur ID:', id);
      }
    </script>

    <!-- Script personnalisé -->
    <script src="{% static 'js/dashboard.js' %}"></script>
  </body>
</html>